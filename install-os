#!/bin/sh

prompt() {
	read -r YESNO
	if [ "$YESNO" = "yes" ]; then
		return
	elif [ "$YESNO" = "no" ]; then
		echo "[ ERROR ] Cancelled" && exit 1
	else
		prompt
	fi
}

checksudo() {
	if [ "$(id -u)" != "0" ]; then
		echo "[ ERROR ] Script must be run as sudo!" && exit 1
	fi
}

diskpart() {
	fdisk -l
	echo -e "\nChoose the disk: (/dev/sdX)"
	read -r DRIVE
	if [ $(fdisk -l | grep "$DRIVE" | wc -l) -gt 0 ]; then
		echo "[ OK ] Found $DRIVE"
	else 
		echo "[ ERROR ] $DRIVE not found" && exit 1
	fi
	echo -e "\nAre you sure $DRIVE is the correct location? (yes/no)"
	prompt
	echo ""
	free --giga
	echo -e "\nEnter your RAM value: (Eg: 5)"
	read -r RAM_TOTAL
	[ -z $RAM_TOTAL ] && echo "[ ERROR ] \$RAM_TOTAL can't be NULL" && exit 1
	[ ! $RAM_TOTAL -gt 0 ] && echo "[ ERROR ] \$RAM_TOTAL can't be smaller than 1" && exit 1
	[ ! $RAM_TOTAL -gt 4 ] && ((SWAP=$RAM_TOTAL*2)) || SWAP=8
	(
	echo o # Create new DOS/MBR disklabel
	echo n # New partition
	echo p # Make it primary
	echo 1 # Partition number 1
	echo   # First sector default
	echo +$SWAP\G # Size: 4G
	echo t # change partition type
	echo 82 # to swap
	echo n # New partition
	echo p # Primary
	echo 2 # Number 2
	echo   # First sector default
	echo   # Size: the rest of the disk
	echo a # toggle bootable
	echo 2 # choose partition number 2
	echo w # write
	) | fdisk $DRIVE
	echo "Done"
}

# Installation steps
checksudo
diskpart
